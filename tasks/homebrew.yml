---
- name: Update homebrew
  homebrew:
    name: git
    state: latest
    update_homebrew: true
  tags:
  - brew

- name: check if .zprofile exists
  stat:
    path: "{{ zprofile_path }}"
  register: zprofile_st

- name: create .zprofile
  file:
    path: "{{ zprofile_path }}"
    state: touch
  when: not zprofile_st.stat.exists

- name: python-specific environment variables
  blockinfile:
    marker: "# {mark} ANSIBLE MANAGED BLOCK python-specific-environments"
    path: "{{ zprofile_path }}"
    block: |
      export PATH="{{ homebrew_extra_paths | join(":") }}"
      export LDFLAGS="{{ homebrew_lib | join(" ") }}"
      export CPPFLAGS="{{ homebrew_include | join(" ") }}"
      export OPENBLAS="{{ homebrew_openblas }}"
      export MACOSX_DEPLOYMENT_TARGET={{ macosx_deployment_target }}
